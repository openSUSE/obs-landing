<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Build Containers | User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.2.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.81.0 (based on DocBook XSL Stylesheets snapshot) - chunked" /><meta name="book-title" content="User Guide" /><meta name="chapter-title" content="Chapter 21. Build Containers" /><meta name="description" content="" /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="par.reference.html" title="Part VI. Reference" /><link rel="prev" href="cha.obs.build_process.html" title="Chapter 20. Build Process" /><link rel="next" href="cha.obs.source_management.html" title="Chapter 22. Source Management" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.reference.html">Reference</a><span> › </span><a class="crumb" href="cha.obs.build_containers.html">Build Containers</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>User Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk02pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="par.first_steps.html"><span class="number">I </span><span class="name">First Steps</span></a><ol><li class="inactive"><a href="art.obs.bg.html"><span class="number">1 </span><span class="name">Beginnerʼs Guide</span></a></li></ol></li><li class="inactive"><a href="par.concepts.html"><span class="number">II </span><span class="name">Concepts</span></a><ol><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">2 </span><span class="name">Supported Build Recipes and Package Formats</span></a></li></ol></li><li class="inactive"><a href="bk02pt03.html"><span class="number">III </span><span class="name">Setup</span></a><ol><li class="inactive"><a href="cha.obs.osc.html"><span class="number">3 </span><span class="name">osc, the Command Line Tool</span></a></li><li class="inactive"><a href="cha.obs.prjconfig.html"><span class="number">4 </span><span class="name">Project Configuration</span></a></li></ol></li><li class="inactive"><a href="par.working.html"><span class="number">IV </span><span class="name">Usage</span></a><ol><li class="inactive"><a href="cha.obs.basicworkflow.html"><span class="number">5 </span><span class="name">Basic OBS Workflow</span></a></li><li class="inactive"><a href="cha.obs.building.html"><span class="number">6 </span><span class="name">Local Building</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">7 </span><span class="name">Using Source Services</span></a></li><li class="inactive"><a href="cha.obs.stagingworkflow.html"><span class="number">8 </span><span class="name">Staging Workflow</span></a></li></ol></li><li class="inactive"><a href="par.best_practices.html"><span class="number">V </span><span class="name">Best Practices</span></a><ol><li class="inactive"><a href="cha.obs.best-practices.webuiusage.html"><span class="number">9 </span><span class="name">Using the OBS Web UI</span></a></li><li class="inactive"><a href="cha.obs.best-practices.basics.html"><span class="number">10 </span><span class="name">Basic Concepts and Work Styles</span></a></li><li class="inactive"><a href="cha.obs.best-practices.scm_integration.html"><span class="number">11 </span><span class="name">How to integrate external SCM sources</span></a></li><li class="inactive"><a href="cha.obs.best-practices.upstream.html"><span class="number">12 </span><span class="name">Publishing Upstream Binaries</span></a></li><li class="inactive"><a href="cha.obs.best-practices.bootstrapping.html"><span class="number">13 </span><span class="name">Bootstrapping</span></a></li><li class="inactive"><a href="cha.obs.best-practices.oscexamples.html"><span class="number">14 </span><span class="name"><code class="command">osc</code> Example Commands</span></a></li><li class="inactive"><a href="cha.obs.best-practices.advanced.html"><span class="number">15 </span><span class="name">Advanced Project Setups</span></a></li><li class="inactive"><a href="cha.obs.best-practices.kmp.html"><span class="number">16 </span><span class="name">Building Kernel Modules</span></a></li><li class="inactive"><a href="cha.obs.best-practices.howto.html"><span class="number">17 </span><span class="name">Common Questions and Solutions</span></a></li></ol></li><li class="inactive"><a href="par.reference.html"><span class="number">VI </span><span class="name">Reference</span></a><ol><li class="inactive"><a href="cha.obs.architecture.html"><span class="number">18 </span><span class="name">OBS Architecture</span></a></li><li class="inactive"><a href="cha.obs.concepts.html"><span class="number">19 </span><span class="name">OBS Concepts</span></a></li><li class="inactive"><a href="cha.obs.build_process.html"><span class="number">20 </span><span class="name">Build Process</span></a></li><li class="inactive"><a href="cha.obs.build_containers.html"><span class="number">21 </span><span class="name">Build Containers</span></a></li><li class="inactive"><a href="cha.obs.source_management.html"><span class="number">22 </span><span class="name">Source Management</span></a></li><li class="inactive"><a href="cha.obs.supported_formats.html"><span class="number">23 </span><span class="name">Supported Formats</span></a></li><li class="inactive"><a href="cha.obs.request_and_review_system.html"><span class="number">24 </span><span class="name">Request And Review System</span></a></li><li class="inactive"><a href="cha.obs.image_templates.html"><span class="number">25 </span><span class="name">Image Templates</span></a></li><li class="inactive"><a href="cha.obs.multibuild.html"><span class="number">26 </span><span class="name">Multiple Build Description File Handling</span></a></li><li class="inactive"><a href="cha.obs.maintenance_setup.html"><span class="number">27 </span><span class="name">Maintenance Support</span></a></li><li class="inactive"><a href="cha.obs.binary_tracking.html"><span class="number">28 </span><span class="name">Binary Package Tracking</span></a></li><li class="inactive"><a href="cha.obs.admin.html"><span class="number">29 </span><span class="name">Administration</span></a></li><li class="inactive"><a href="cha.obs.build_scheduling_and_dispatching.html"><span class="number">30 </span><span class="name">Scheduling and Dispatching</span></a></li><li class="inactive"><a href="cha.obs.build_job_constraints.html"><span class="number">31 </span><span class="name">Build Job Constraints</span></a></li><li class="inactive"><a href="cha.obs.build_preinstall.html"><span class="number">32 </span><span class="name">Building Preinstall Images</span></a></li><li class="inactive"><a href="cha.obs.authorization.token.html"><span class="number">33 </span><span class="name">Authorization</span></a></li><li class="inactive"><a href="cha.obs.qa_hooks.html"><span class="number">34 </span><span class="name">Quality Assurance(QA) Hooks</span></a></li><li class="inactive"><a href="cha.obs.factory.html"><span class="number">35 </span><span class="name">openSUSE Factory</span></a></li></ol></li><li class="inactive"><a href="obs.glossary.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="bk02apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 20. Build Process" href="cha.obs.build_process.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Source Management" href="cha.obs.source_management.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.reference.html">Reference</a><span> › </span><a class="crumb" href="cha.obs.build_containers.html">Build Containers</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 20. Build Process" href="cha.obs.build_process.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Source Management" href="cha.obs.source_management.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.build_containers"><div class="titlepage"><div><div><h2 class="title"><span class="number">21 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Build Containers</span> <a title="Permalink" class="permalink" href="cha.obs.build_containers.html#">#</a></h2></div><div><div class="abstract">
   
  </div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.build_containers.html#_supported_formats"><span class="number">21.1 </span><span class="name">Supported Container Formats</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.build_containers.html#_container_registry"><span class="number">21.2 </span><span class="name">Container Registry</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.build_containers.html#_image_signatures"><span class="number">21.3 </span><span class="name">Container Image Signatures</span></a></span></dt></dl></div></div>
 
 
 <p>
  Containers are workloads which embed all necessary files to make the workload
  independent of the running host OS. This includes (but is not limited to)
  libraries, executables and shared resource files.
 </p>

 <div class="sect1 " id="_supported_formats"><div class="titlepage"><div><div><h2 class="title"><span class="number">21.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Supported Container Formats</span> <a title="Permalink" class="permalink" href="cha.obs.build_containers.html#_supported_formats">#</a></h2></div></div></div>
  

  <p>
   A container that is providing its own kernel is commonly called a virtual
   machine and will be referred to as such in this book. The Open Build Service
   (OBS) supports container builds either by supporting the native build format
   or as side product of a different format. This ranges is from very simple
   chroot containers over server (for example, Docker) or desktop formats (for
   example, AppImages, Snaps or Flatpaks) up to full VM builds (such as for
   OpenStack, KVM, or as a Live CD via KIWI).
  </p>

  <div class="variablelist "><dl class="variablelist"><dt id="id-1.5.10.5.4.3.1"><span class="term ">SimpleImage</span></dt><dd>
     <p>
      SimpleImage is a special format which uses the rpm spec file syntax and
      just packages the resulting install root as tar ball or squashfs image.
      The format is just using the BuildRequires tags from a file called
      <code class="filename">simpleimage</code>, it supports also rpm macro handling to
      allow for exceptions depending on the build environment.
     </p>
    </dd><dt id="id-1.5.10.5.4.3.2"><span class="term ">Docker</span></dt><dd>
     <p>
      Docker images can be built either via the KIWI tool or from
      Dockerfiles.
     </p>
    </dd><dt id="id-1.5.10.5.4.3.3"><span class="term ">AppImage</span></dt><dd>
     <p>
      The desktop-oriented AppImage format is currently only created as a side
      effect of an RPM build. Open Build Service (OBS) supports signing and
      publishing the .AppImage files, the rest is handled via wrapper packages
      which converts an RPM (or DEB package) into an AppImage file. Own build
      rules can provided via a <code class="filename">Recipe</code> file, fallback code
      will be used if no <code class="filename">Recipe</code> file is available.
     </p>
    </dd><dt id="id-1.5.10.5.4.3.4"><span class="term ">Snap</span></dt><dd>
     <p>
      The Snap format is supported natively. However, external resources are
      only supported via source services and therefore not all build types are
      supported. Snapcraft only works with Ubuntu-based base systems. (Code to
      support RPM-based distributions exists as well but has not been merged
      upstream yet.)
     </p>
    </dd><dt id="id-1.5.10.5.4.3.5"><span class="term ">Flatpak</span></dt><dd>
     <p>
      Flatpak packages can be built in the Open Build Service, see
      <a class="xref" href="cha.obs.package_formats.html#sec.pkgfmt.flatpak" title="2.8. Flatpak">Section 2.8, “Flatpak”</a> for further details.
     </p>
    </dd><dt id="id-1.5.10.5.4.3.6"><span class="term ">Livebuild</span></dt><dd>
     <p>
      Livebuild is the Debian livebuild support for ISO images.
     </p>
    </dd></dl></div>

  
 </div>
 <div class="sect1 " id="_container_registry"><div class="titlepage"><div><div><h2 class="title"><span class="number">21.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Container Registry</span> <a title="Permalink" class="permalink" href="cha.obs.build_containers.html#_container_registry">#</a></h2></div></div></div>
  

  <p>
   Container Registries are repositories that container images are published
   and can be automatically pulled from using tools like
   <a class="ulink" href="https://podman.io/" target="_blank">podman<span class="ulink-url"> (https://podman.io/)</span></a> or
   <a class="ulink" href="https://www.docker.com/" target="_blank">docker<span class="ulink-url"> (https://www.docker.com/)</span></a>.
  </p>

  <p>
   The Open Build Service will automatically publish container images in a
   OCI-compatible registry, with the URLs to the images constructed as follows:
   <code class="literal"> $BASE/$PROJECT/$REPOSITORY/$IMAGE_NAME:$TAG </code> with the
   following components:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     <p>
      <code class="literal">$BASE</code>: URL/IP under which the Open Build Service
      instance is reachable
     </p>
    </li><li class="listitem ">
     <p>
      <code class="literal">$PROJECT</code>: The name of the project where the image is
      build, with all colons replaced with forward slashes.
     </p>
    </li><li class="listitem ">
     <p>
      <code class="literal">$REPOSITORY</code>: The name of the repository where the
      containers are published.
     </p>
    </li><li class="listitem ">
     <p>
      <code class="literal">$IMAGE_NAME</code>: The name of this container image. It
      defaults to the name of the package from which the container is build.
      Alternatively, a different image name can be specified in the build
      recipe, e.g. via the <code class="literal">containerconfig</code> element in a
      KIWI file (see
      <a class="ulink" href="https://osinside.github.io/kiwi/building_images/build_docker_container.html?highlight=containerconfig" target="_blank">the
      kiwi documentation<span class="ulink-url"> (https://osinside.github.io/kiwi/building_images/build_docker_container.html?highlight=containerconfig)</span></a> for further details).
     </p>
    </li><li class="listitem ">
     <p>
      <code class="literal">$TAG</code>: The image tag. This defaults to
      <code class="literal">latest</code> with alternatives being provided in a similar
      fashion as the image's name.
     </p>
    </li></ul></div><p>
  </p>

  <p>
   The
   <a class="ulink" href="https://github.com/openSUSE/cooverview" target="_blank">cooverview<span class="ulink-url"> (https://github.com/openSUSE/cooverview)</span></a>
   project provides a simple user-facing webpage to search for containers
   published by the Open Build Service and can be used to conveniently obtain
   the correct registry URLs. It is used to power
   <a class="ulink" href="https://registry.opensuse.org/" target="_blank">registry.opensuse.org<span class="ulink-url"> (https://registry.opensuse.org/)</span></a>
  </p>
 </div>
 <div class="sect1 " id="_image_signatures"><div class="titlepage"><div><div><h2 class="title"><span class="number">21.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Container Image Signatures</span> <a title="Permalink" class="permalink" href="cha.obs.build_containers.html#_image_signatures">#</a></h2></div></div></div>
  

  <p>
   The Open Build Service automatically signs every package that has been build and
   publishes the cryptographic signature alongside with it. Container images
   are no exception to this and the detached signatures can be used by
   <a class="ulink" href="https://podman.io/" target="_blank">podman<span class="ulink-url"> (https://podman.io/)</span></a> to verify every image
   that is pulled from the registry.
  </p>

  <p>
   Podman has to be configured first as outlined in the following steps.
  </p>

  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     Create a <code class="literal">yaml</code> file under
     <code class="literal">/etc/containers/registries.d/</code> with an appropriate name
     for your instance and the following contents:
     </p><div class="example" id="id-1.5.10.5.6.4.1.1.3"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.1: </span><span class="name">registry.yaml </span><a title="Permalink" class="permalink" href="cha.obs.build_containers.html#id-1.5.10.5.6.4.1.1.3">#</a></h6></div><div class="example-contents">
      
<div class="verbatim-wrap"><pre class="screen">---
docker:
  <em class="replaceable ">REGISTRY_URL</em>:
    sigstore: <em class="replaceable ">REGISTRY_URL</em>/sigstore</pre></div>
     </div></div><p>
     Replace <em class="replaceable ">REGISTRY_URL</em> with the appropriate URL
     to your instance of Open Build Service (for example,
     <code class="literal">registry.opensuse.org</code>).
    </p>
   </li><li class="listitem ">
    <p>
     Add the following object into the key <code class="literal">transports</code> in the
     file <code class="filename">/etc/containers/policy.json</code>:
    </p>
    <div class="example" id="id-1.5.10.5.6.4.2.2"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.2: </span><span class="name">policy.json </span><a title="Permalink" class="permalink" href="cha.obs.build_containers.html#id-1.5.10.5.6.4.2.2">#</a></h6></div><div class="example-contents">
     
<div class="verbatim-wrap"><pre class="screen">    "docker": {
      "<em class="replaceable ">REGISTRY_URL</em>": [
        {
          "type": "signedBy",
          "keyType": "GPGKeys",
          "keyPath": "<em class="replaceable ">PATH_TO_PUBLIC_KEY</em>"
        }
      ]
    }</pre></div>
    </div></div>
    <p>
     The complete <code class="filename">/etc/containers/policy.json</code> can then
     look like this:
    </p>
    <div class="example" id="id-1.5.10.5.6.4.2.4"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.3: </span><span class="name">policy.json </span><a title="Permalink" class="permalink" href="cha.obs.build_containers.html#id-1.5.10.5.6.4.2.4">#</a></h6></div><div class="example-contents">
     
<div class="verbatim-wrap"><pre class="screen">{
  "default": [
    {
      "type": "insecureAcceptAnything"
    }
  ],
  "transports": {
    "docker-daemon": {
      "": [
        {
          "type": "insecureAcceptAnything"
        }
      ]
    },
    "docker": {
      "<em class="replaceable ">REGISTRY_URL</em>": [
        {
          "type": "signedBy",
          "keyType": "GPGKeys",
          "keyPath": "<em class="replaceable ">PATH_TO_PUBLIC_KEY</em>"
        }
      ]
    }
  }
}</pre></div>
    </div></div>
   </li><li class="listitem ">
    <p>
     Save the public key of the project where your image is build under
     <em class="replaceable ">PATH_TO_PUBLIC_KEY</em> (you can choose any location
     to which you have read access, only ensure that you specify it in
     <code class="filename">/etc/containers/policy.json</code> as well).
    </p>
   </li></ul></div>

  <p>
   Podman will from now on automatically fetch the published signatures from
   the backend and verify them before storing the images locally.
  </p>
 </div>
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.source_management.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 22 </span>Source Management</span></a><a class="nav-link" href="cha.obs.build_process.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 20 </span>Build Process</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>