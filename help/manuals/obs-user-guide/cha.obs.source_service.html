<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Using Source Services | User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="book-title" content="User Guide" /><meta name="chapter-title" content="Chapter 6. Using Source Services" /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="par.working.html" title="Part III. Usage" /><link rel="prev" href="cha.obs.building.html" title="Chapter 5. Building Package Formats" /><link rel="next" href="book.obs-admin.html" title="Administrator Guide" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.working.html">Usage</a><span> › </span><a class="crumb" href="cha.obs.source_service.html">Using Source Services</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>User Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk02pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="par.concepts.html"><span class="number">I </span><span class="name">Concepts</span></a><ol><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">1 </span><span class="name">Supported Build Recipes and Package Formats</span></a></li></ol></li><li class="inactive"><a href="bk02pt02.html"><span class="number">II </span><span class="name">Setup</span></a><ol><li class="inactive"><a href="cha.obs.osc.html"><span class="number">2 </span><span class="name">osc, the Command Line Tool</span></a></li><li class="inactive"><a href="cha.obs.prjconfig.html"><span class="number">3 </span><span class="name">Project Configuration</span></a></li></ol></li><li class="inactive"><a href="par.working.html"><span class="number">III </span><span class="name">Usage</span></a><ol><li class="inactive"><a href="cha.obs.basicworkflow.html"><span class="number">4 </span><span class="name">Basic OBS Workflow</span></a></li><li class="inactive"><a href="cha.obs.building.html"><span class="number">5 </span><span class="name">Building Package Formats</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">6 </span><span class="name">Using Source Services</span></a></li></ol></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 5. Building Package Formats" href="cha.obs.building.html"><span class="prev-icon">←</span></a><span class="tool-spacer"><span class="next-icon">→</span></span></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.working.html">Usage</a><span> › </span><a class="crumb" href="cha.obs.source_service.html">Using Source Services</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 5. Building Package Formats" href="cha.obs.building.html"><span class="prev-icon">←</span></a><span class="tool-spacer"><span class="next-icon">→</span></span></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.source_service"><div class="titlepage"><div><div><h2 class="title"><span class="number">6 </span><span class="name">Using Source Services</span> </h2></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.source_service.html#sec.obs.sserv.about"><span class="number">6.1 </span><span class="name">About Source Service</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.source_service.html#sec.obs.sserv.mode"><span class="number">6.2 </span><span class="name">Modes of Services</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.source_service.html#sec.obs.sserv.validate"><span class="number">6.3 </span><span class="name">Defining Services for Validation</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.source_service.html#sec.obs.sserv.create"><span class="number">6.4 </span><span class="name">Creating Source Service Definitions</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.source_service.html#sec.obs.sserv.remove"><span class="number">6.5 </span><span class="name">Removing a Source Service</span></a></span></dt></dl></div></div>
 
 

 <div class="sect1 " id="sec.obs.sserv.about"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.sserv.about"><span class="number">6.1 </span><span class="name">About Source Service</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#sec.obs.sserv.about">#</a></h2></div></div></div>
  
  <p>
   Source Services are tools to validate, generate or modify sources in a
   trustable way. They are designed as smallest possible tools and can be
   combined following the powerful idea of the classic UNIX design.
  </p>
  <p>
   Source services allow:
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     Server side generated files are easy to identify and are not
     modifiable by the user. This way other user can trust them to be
     generated in the documented way without modifications.
    </p>
   </li><li class="listitem ">
    <p>
     Generated files never create merge conflicts.
    </p>
   </li><li class="listitem ">
    <p>
     Generated files are a separate commit to the user change.
    </p>
   </li><li class="listitem ">
    <p>
     Services are runnable at any time without user commit.
    </p>
   </li><li class="listitem ">
    <p>
     Services are runnable on server and client side in the same way.
    </p>
   </li><li class="listitem ">
    <p>
     Services are safe. A source checkout and service run never harms
     the system of a user.
    </p>
   </li><li class="listitem ">
    <p>
     Services avoid unnecessary commits.
     This means there are no time-dependent changes. In case the package
     already contains the same file, the newly generated file are dropped.
    </p>
   </li><li class="listitem ">
    <p>
     Services running local or inside the build environment can get created,
     added and used by everybody.
    </p>
   </li><li class="listitem ">
    <p>
     Services running in default or server side mode must be installed by
     the administrator of the OBS server.
    </p>
   </li><li class="listitem ">
    <p>
     The use of a service can be defined per package or project wide.
    </p>
   </li></ul></div>
  <p>
   For using source services you need (refer to <a class="xref" href="cha.obs.source_service.html#ex.obs.sserv.struct" title="Structure of a _service File">Example 6.1, “Structure of a <code class="filename">_service</code> File”</a>):
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     An XML file named <code class="filename">_service</code>.
    </p>
   </li><li class="listitem ">
    <p>
     A root element <code class="sgmltag-element">services</code>.
    </p>
   </li><li class="listitem ">
    <p>
     A <code class="sgmltag-element">service</code> element which uses the specific service with
     optional parameters.
    </p>
   </li></ul></div>
  <div class="example" id="ex.obs.sserv.struct"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 6.1: </span><span class="name">Structure of a <code class="filename">_service</code> File </span><a title="Permalink" class="permalink" href="cha.obs.source_service.html#ex.obs.sserv.struct">#</a></h6></div><div class="example-contents">
   
  <div class="verbatim-wrap highlight xml"><pre class="screen">&lt;services&gt; <span id="co.obs.sserv.struct.services"></span><span class="callout">1</span>
 &lt;service name="<em class="replaceable ">MY_SCRIPT</em>"<span id="co.obs.sserv.struct.name"></span><span class="callout">2</span> mode="<em class="replaceable ">MODE</em>"<span id="co.obs.sserv.struct.mode"></span><span class="callout">3</span>&gt;
  &lt;param name="<em class="replaceable ">PARAMETER1</em>"&gt;<em class="replaceable ">PARAMETER1_VALUE</em>&lt;/param&gt;<span id="co.obs.sserv.struct.param"></span><span class="callout">4</span>
 &lt;/service&gt;
&lt;/services&gt;</pre></div>
   <div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.obs.sserv.struct.services"><span class="callout">1</span></a> </p></td><td valign="top" align="left">
     <p>
      The root element of a <code class="filename">_service</code> file.
     </p>
    </td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.obs.sserv.struct.name"><span class="callout">2</span></a> </p></td><td valign="top" align="left">
     <p>
      The service name. The service is a script that is stored in the
      <code class="filename">/usr/lib/obs/service</code> directory.
     </p>
    </td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.obs.sserv.struct.mode"><span class="callout">3</span></a> </p></td><td valign="top" align="left">
     <p>
      Mode of the service, see <a class="xref" href="cha.obs.source_service.html#sec.obs.sserv.mode" title="6.2. Modes of Services">Section 6.2, “Modes of Services”</a>.
     </p>
    </td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.obs.sserv.struct.param"><span class="callout">4</span></a> </p></td><td valign="top" align="left">
     <p>
      One or more parameters which are passed to the script defined in
      <a class="xref" href="cha.obs.source_service.html#co.obs.sserv.struct.name"><span class="callout">2</span></a>.
     </p>
    </td></tr></table></div>
  </div></div>
  <p>
   The example above will execute the script:
  </p>
  <div class="verbatim-wrap"><pre class="screen"><code class="command">/usr/lib/obs/service/<em class="replaceable ">MY_SCRIPT</em></code> --<em class="replaceable ">PARAMETER1</em> <em class="replaceable ">PARAMETER1_VALUE</em> --outdir <em class="replaceable ">DIR</em></pre></div>
  
 </div>

 <div class="sect1 " id="sec.obs.sserv.mode"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.sserv.mode"><span class="number">6.2 </span><span class="name">Modes of Services</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#sec.obs.sserv.mode">#</a></h2></div></div></div>
  
  <p> Each service can be used in a mode defining when it should run
   and how to use the result. This can be done per package or globally for an
   entire project. </p>

  <div class="variablelist "><dl class="variablelist"><dt id="idm139937490439440"><span class="term ">Default Mode</span></dt><dd>
     <p>
      The default mode of a service is to always run after each commit on
      the server side and locally before every local build.
     </p>
    </dd><dt id="idm139937490437584"><span class="term "><code class="literal">trylocal</code> Mode</span></dt><dd>
     <p>
      This mode is running the service locally. The result is committed
      as standard files and not named with a <code class="literal">_service:</code>
      prefix. Additionally, the service runs on the server by
      default. Usually the service should detect that the result is the same
      and skip the generated files. In case they differ, they are generated
      and added on the server.
     </p>
    </dd><dt id="idm139937490434624"><span class="term "><code class="literal">localonly</code> Mode</span></dt><dd>
     <p>
      This mode is running the service locally. The result gets committed
      as standard files and not named  with <code class="literal">_service:</code> prefix.
      The service is never running on the server side. It is also not
      possible to trigger it manually.
     </p>
    </dd><dt id="idm139937490431728"><span class="term "><code class="literal">serveronly</code> Mode</span></dt><dd>
     
     <p>
      The serviceonly mode is running the service on the service only. This
      can be useful, when the service is not available or can not work on
      developer workstations.
     </p>
    </dd><dt id="idm139937490429088"><span class="term "><code class="literal">buildtime</code> Mode</span></dt><dd>
     <p>
      The service is running inside of the build job, both for local and
      server side builds. A side effect is that the service package is
      becoming a build dependency and must be available. Every user can
      provide and use a service this way in their projects. The generated
      sources are not part of the source repository, but part of the
      generated source packages.
      Note that services requiring external network access are likely to
      fail in this mode, because such access is not available if the build
      workers are running in secure mode<span class="phrase"> (as is always the case at <a class="ulink" href="https://build.opensuse.org" target="_blank">https://build.opensuse.org</a>)</span>.
     </p>
    </dd><dt id="idm139937490424896"><span class="term "><code class="literal">disabled</code> Mode</span></dt><dd>
     <p>
      The disabled mode is neither running the service locally nor on the
      server side. It can be used to temporarily disable the service but keeping
      the definition as part of the service definition. Or it can be used to
      define the way how to generate the sources and doing so by manually calling
      <code class="command">osc service disabledrun</code> The result will
      get committed as standard files again.
     </p>
    </dd></dl></div>
 </div>

 <div class="sect1 " id="sec.obs.sserv.validate"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.sserv.validate"><span class="number">6.3 </span><span class="name">Defining Services for Validation</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#sec.obs.sserv.validate">#</a></h2></div></div></div>
  
  <p>
   Source Services can be used to validate sources. This can be defined
   at different levels:
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     <span class="formalpara-title">Per Package. </span>
     
      Useful when the packager wants to validate whether the downloaded
      sources are really from the original maintainer.
     
    </p>
   </li><li class="listitem ">
    <p>
     <span class="formalpara-title">Per Project. </span>
     
      Useful for applying project-wide policies which cannot be skipped for
      any package.
     
    </p>
   </li></ul></div>

  <p>
   You can validate sources using either of two methods:
  </p>
  
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     By comparing checksums and metadata of the files in your repository
     with checksums and metadata as recorded by the maintainer.
    </p>
   </li><li class="listitem ">
    <p>
     Alternatively, you can download the sources from a trusted location
     again and verify that they did not change.
    </p>
   </li></ul></div>
 </div>

 <div class="sect1 " id="sec.obs.sserv.create"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.sserv.create"><span class="number">6.4 </span><span class="name">Creating Source Service Definitions</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#sec.obs.sserv.create">#</a></h2></div></div></div>
  
  <p>
   Source services are defined in the <code class="filename">_service</code> file
   and are either part of the package sources or used project-wide.
   Project-wide services are stored under the <code class="uri">_project</code> package
   in file <code class="filename">_service</code>.
   package
  </p>
  <p> The <code class="filename">_service</code> file contains a list of services
   which get called in the listed order. Each service can define a list of
   parameters and a mode.
   The project wide services get called after the per package defined
   services.
   </p>
  <p>
   The <code class="filename">_service</code> file is in XML format and looks like this:
  </p>
  <div class="verbatim-wrap highlight xml"><pre class="screen">&lt;services&gt;
  &lt;service name="download_files" mode="trylocal" /&gt;
  &lt;service name="verify_file"&gt;
    &lt;param name="file"&gt;krabber-1.0.tar.gz&lt;/param&gt;
    &lt;param name="verifier"&gt;sha256&lt;/param&gt;
    &lt;param name="checksum"&gt;7f535a96a834b31ba2201a90c4d365990785dead92be02d4cf846713be938b78&lt;/param&gt;
  &lt;/service&gt;
  &lt;service name="update_source" mode="disabled" /&gt;
&lt;/services&gt;</pre></div>
  <p>
   With the example above, the services above are executed in the
   following order:
  </p>
  <div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem ">
    <p>
     Downloads the file via the <code class="systemitem">download_files</code>
     service using the URL from the Spec file.
     When using osc, the downloaded file gets committed as part of the commit.
    </p>
   </li><li class="listitem ">
    <p>
     Compares the downloaded file (<code class="filename">krabber-1.0.tar.gz</code>)
     against the SHA256 checksum.
    </p>
   </li><li class="listitem ">
    <p>
     When <code class="command">osc service disabledrun</code> is run manually, update
     the source archive from an online source. In all other cases, ignore
     this part of the <code class="filename">_service</code> file.
    </p>
   </li></ol></div>
 </div>

 <div class="sect1 " id="sec.obs.sserv.remove"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.sserv.remove"><span class="number">6.5 </span><span class="name">Removing a Source Service</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#sec.obs.sserv.remove">#</a></h2></div></div></div>
  
  <p> Sometimes it is useful to continued to work on generated files
   manually. In this situation the <code class="filename">_service</code> file needs
   to be dropped, but all
   generated files need to be committed as standard files. The OBS
   provides the <code class="command">mergeservice</code> command for this. It can
   also be used via <code class="command">osc</code> by calling
    <code class="command">osc service merge</code>. </p>
 </div>

 
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.building.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 5 </span>Building Package Formats</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>