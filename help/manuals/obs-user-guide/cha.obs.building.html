<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Local Building | User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.13 (based on DocBook XSL Stylesheets snapshot) - chunked" /><meta name="book-title" content="User Guide" /><meta name="chapter-title" content="Chapter 5. Local Building" /><meta name="description" content="Every build which happens on the server can also be executed locally in the same environment using the osc tool. All what you need is to checkout the source code and build the build recipe. The following explains it for RPM format, but it works for any. osc will download needed binaries and execute the local build." /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="par.working.html" title="Part III. Usage" /><link rel="prev" href="cha.obs.basicworkflow.html" title="Chapter 4. Basic OBS Workflow" /><link rel="next" href="cha.obs.source_service.html" title="Chapter 6. Using Source Services" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.working.html">Usage</a><span> › </span><a class="crumb" href="cha.obs.building.html">Local Building</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.htmlindex.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>User Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk02pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="par.concepts.html"><span class="number">I </span><span class="name">Concepts</span></a><ol><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">1 </span><span class="name">Supported Build Recipes and Package Formats</span></a></li></ol></li><li class="inactive"><a href="bk02pt02.html"><span class="number">II </span><span class="name">Setup</span></a><ol><li class="inactive"><a href="cha.obs.osc.html"><span class="number">2 </span><span class="name">osc, the Command Line Tool</span></a></li><li class="inactive"><a href="cha.obs.prjconfig.html"><span class="number">3 </span><span class="name">Project Configuration</span></a></li></ol></li><li class="inactive"><a href="par.working.html"><span class="number">III </span><span class="name">Usage</span></a><ol><li class="inactive"><a href="cha.obs.basicworkflow.html"><span class="number">4 </span><span class="name">Basic OBS Workflow</span></a></li><li class="inactive"><a href="cha.obs.building.html"><span class="number">5 </span><span class="name">Local Building</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">6 </span><span class="name">Using Source Services</span></a></li><li class="inactive"><a href="cha.obs.stagingworkflow.html"><span class="number">7 </span><span class="name">Staging Workflow</span></a></li></ol></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 4. Basic OBS Workflow" href="cha.obs.basicworkflow.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Using Source Services" href="cha.obs.source_service.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.working.html">Usage</a><span> › </span><a class="crumb" href="cha.obs.building.html">Local Building</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 4. Basic OBS Workflow" href="cha.obs.basicworkflow.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Using Source Services" href="cha.obs.source_service.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.building"><div class="titlepage"><div><div><h2 class="title"><span class="number">5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Local Building</span> </h2></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.obs.building.html#id-1.5.7.3.2.1">#</a></h6></div>
   <p>
      Every build which happens on the server can also be executed locally in the same environment using
      the osc tool. All what you need is to checkout the source code and build the build recipe. The 
      following explains it for RPM format, but it works for any. osc will download needed binaries
      and execute the local build.
   </p>
  </div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.building.html#sec.obs.building.generic"><span class="number">5.1 </span><span class="name">Generic build options</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.building.html#sec.obs.building.advanced"><span class="number">5.2 </span><span class="name">Advanced Build Environment Handling</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.building.html#sec.obs.building.spec2rpm"><span class="number">5.3 </span><span class="name">Spec File Specials (RPM)</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.building.html#id-1.5.7.3.7"><span class="number">5.4 </span><span class="name">Kiwi Appliance Specials (KIWI)</span></a></span></dt></dl></div></div>
 
 
 
 
 <div class="sect1 " id="sec.obs.building.generic"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.building.generic"><span class="number">5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Generic build options</span> <a title="Permalink" class="permalink" href="cha.obs.building.html#sec.obs.building.generic">#</a></h2></div></div></div>
  
  <p>
     Independend of the build format you need at least one source file as build description.
     The file name and structure is format specific. You can find some supported formats described below.
     To build your build format, you need:
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     <p>the original source archive. Instead of that the package may contain a _service file which
	   describes how to create it, for example by downloading it or building it from a SCM repository.
	   It can also be used to create the build description file. Find more details about it in the
	   source service chapter.
      </p>
   </li><li class="listitem ">
    <p>
     optional patches which changes the original source code to fix problems
     regarding security, the build process, or other issues
    </p>
   </li><li class="listitem ">
    <p>
     other files which do not fall into one of the previous categories
    </p>
   </li></ul></div>
  <p>
   For existing packages, this is already the case. To build an
   existing package, the general procedure is as follows:</p>
  <div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step ">
    <p>
     If you have not done so yet, set up your project as shown in
     <a class="xref" href="cha.obs.basicworkflow.html#sec.obs.basicworkflow.setuphome" title="4.1. Setting Up Your Home Project">Section 4.1, “Setting Up Your Home Project”</a>.
    </p>
   </li><li class="step ">
    <p>
     In the terminal, choose or create a directory on a local partition that
     has enough space to hold the package sources.
    </p>
   </li><li class="step ">
    <p>
     Check out the project that contains the package:
    </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> checkout <em class="replaceable ">PROJECT</em> <em class="replaceable ">PACKAGE</em></pre></div>
    <p>
     This creates a <code class="filename"><em class="replaceable ">PROJECT</em>/<em class="replaceable ">PACKAGE</em></code>
     directory in the current directory.
    </p>
   </li><li class="step ">
    <p>
     Change into the directory:
    </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">cd</code> <em class="replaceable ">PROJECT</em>/<em class="replaceable ">PACKAGE</em></pre></div>
   </li><li class="step ">
    <p>
     The simplest way to run a build is just to call the build command. osc will try
     to detect your installed OS and build for it if possible.
    </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> build</pre></div>
    <p>
     However, you may also manualy specify the build target. For example openSUSE Tumbleweed for
     x86_64, you want to create the RPM package:
    </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> build openSUSE_Tumbleweed x86_64</pre></div>
   </li><li class="step ">
    <p>
	It will download the required dependencies and execute the build script. Therefore it needs to ask for root 
	permissions in most cases.
    </p>
    <div class="variablelist "><dl class="variablelist"><dt id="id-1.5.7.3.4.5.6.2.1"><span class="term ">Successful Build</span></dt><dd>

       <div class="verbatim-wrap"><pre class="screen">[   15s] RPMLINT report:
[   15s] ===============
[   16s] 2 packages and 0 specfiles checked; 0 errors, 0 warnings.
[   16s]
[   16s]
[   16s] venus finished "build <em class="replaceable ">PACKAGE</em>.spec" at Fri Sep  1 11:54:31 UTC 2017.
[   16s]

/var/tmp/build-root/openSUSE_Tumbleweed-x86_64/home/abuild/rpmbuild/SRPMS/<em class="replaceable ">PACKAGE</em>-<em class="replaceable ">VERSION</em>-0.src.rpm

/var/tmp/build-root/openSUSE_Tumbleweed-x86_64/home/abuild/rpmbuild/RPMS/noarch/<em class="replaceable ">PACKAGE</em>-<em class="replaceable ">VERSION</em>-0.noarch.rpm</pre></div>
      </dd><dt id="id-1.5.7.3.4.5.6.2.2"><span class="term ">Unsuccessful Build</span></dt><dd>

       <div class="verbatim-wrap"><pre class="screen">[    8s] venus failed "build <em class="replaceable ">PACKAGE</em>.spec" at Fri Sep  1 11:58:55 UTC 2017.
[    8s]

The buildroot was: /var/tmp/build-root/openSUSE_Tumbleweed-x86_64</pre></div>
      </dd></dl></div>
    <p>
     A successful build of a spec file ends with the creation of the RPM and SRPM files.
    </p>
   </li><li class="step ">
    <p>
     For a detailed log, see the file
     <code class="filename">/var/tmp/build-root/openSUSE_Tumbleweed-x86_64/.build.log</code>.
    </p>
   </li></ol></div></div>
 </div>

 <div class="sect1 " id="sec.obs.building.advanced"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.building.advanced"><span class="number">5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Advanced Build Environment Handling</span> <a title="Permalink" class="permalink" href="cha.obs.building.html#sec.obs.building.advanced">#</a></h2></div></div></div>
  
  <p>
	  The default build environment for local builds is usually chroot. While this is simplest environment
	  and is therefore easy and fast to handle, it has also a number of shortcummings. For one it is
	  not safe against attacks, so you must not build sources or using build dependendencies from a resource
	  which you do not trust. Furthermore the environment is not fully isolated and runs not the kernel the
	  target distribution runs. This means esp image builds and kernel/hardware specific builds may fail or
	  won't produce the same result. The server side is usually set to inside of KVM therefore to avoid this.
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     <p>You can build also local in KVM (if your hardware supports it) by running
      </p>
      <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> build --vm-type=kvm --vm-memory=<em class="replaceable ">MB</em></pre></div>
   </li><li class="listitem ">
      <p>Another important virtualization mode is qemu. This can be used to build for a foreign hardware
	      architecture even when the distribution is not prepared for the qemu user land emulator. However, this
	      qemu system emulator approach will be much slower. 
      </p>
      <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> build --vm-type=qemu --vm-memory=<em class="replaceable ">MB</em> <em class="replaceable ">REPOSITORY</em> <em class="replaceable ">ARCHITECTURE</em></pre></div>
   </li><li class="listitem ">
     <p>You may want to jump inside of a the build environment for debugging purposes. This can be done via the following command:
           </p>
      <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> shell --vm-type=<em class="replaceable ">VM</em></pre></div>
   </li><li class="listitem ">
     <p>To remove the build environemnt, use:
           </p>
      <div class="verbatim-wrap"><pre class="screen"><code class="prompt user">geeko &gt; </code><code class="command">osc</code> wipe --vm-type=<em class="replaceable ">VM</em></pre></div>
   </li></ul></div>
 </div>

 <div class="sect1 " id="sec.obs.building.spec2rpm"><div class="titlepage"><div><div><h2 class="title" id="sec.obs.building.spec2rpm"><span class="number">5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Spec File Specials (RPM)</span> <a title="Permalink" class="permalink" href="cha.obs.building.html#sec.obs.building.spec2rpm">#</a></h2></div></div></div>
  
  <p>
     To create an RPM package, you need a spec file.
  </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
    <p>
     A file with the extension <code class="filename">.changes</code>
     can be used to document the package history, but it is not required.
    </p>
   </li><li class="listitem ">
    <p>
     OBS specific RPM macros which are set are: <code class="literal">%_project</code> and <code class="literal">%_repository</code>
    </p>
   </li></ul></div>
 </div>

 

 

 

 


 <div class="sect1 " id="id-1.5.7.3.7"><div class="titlepage"><div><div><h2 class="title" id="id-1.5.7.3.7"><span class="number">5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Kiwi Appliance Specials (KIWI)</span> <a title="Permalink" class="permalink" href="cha.obs.building.html#id-1.5.7.3.7">#</a></h2></div></div></div>
  
   
   <p>
	KIWI appliance builds create images which can be used for direct consument. Note: builds in non-VM 
	environments do fail often due to the bootloader setup. Use osc build --vm-type=kvm for local building.
	OBS is evaluating kiwi builds at least two times. One time for the build host dependencies and another
	time for the target distribution used inside of the image. For container builds a third evaluation
	happens to find the base container.
   </p>
   <p>
     kiwi builds inside of OBS need to fullfil following requirements:
   </p>
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     <p>config.xml files need to be renamed to a filename with .kiwi suffix. </p>
   </li><li class="listitem ">
     <p>repositories which are used must use either a URL which starts with the OBS download prefix or they must
  	   be written in obs://PROJECT/REPOSITORY syntax. </p>
   </li></ul></div>

   <p>
     OBS extends kiwi functionality with following options:
   </p>
  
  <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     <p>A repository defined as obsrepositories:/ will used the expanded list of repositories as defined in the proejct meta.
           This is useful when moving kiwi image descriptions between projects, for example for development and release builds. </p>
   </li><li class="listitem ">
     <p>An exclusive architecture list to build for can be defined with an xml comment <code class="command">OBS-ExclusiveArch: ARCH_LIST</code> 
     </p>
   </li><li class="listitem ">
     <p>An excluded architecture list to skip builds can be defined with an xml comment <code class="command">OBS-ExcludeArch: ARCH_LIST</code> 
     </p>
   </li><li class="listitem ">
     <p>A list of profiles to build can be defined via an xml comment <code class="command">OBS-Profiles: PROFILE_LIST</code> 
     </p>
     <p>This can also be handled via _multibuild flavor lists by setting a fixed string of <code class="command">OBS-Profiles: @BUILD_FLAVOR@</code> 
     </p>
   </li><li class="listitem ">
     <p>Packages get picked usually in a fixed order from the most important repository in OBS. This happens independend 
  	 of the version number of the packages. Set the xml comment <code class="command">OBS-UnorderedRepos</code> to disable the repository order handling and to have a more similar behaviour as with plain package manager builds. Note: this can result into switching 
  	 repositories between builds and is therefore less reproducible.
     </p>
   </li><li class="listitem ">
     <p>Container builds can specify a specific repository which shall be used for searching the base container. 
  	   Use the xml comment <code class="command">OBS-Imagerepo:$REPOSITORY_URL</code> for this. The repository url may be
  	   in obs://$PROJECT/$REPOSITORY style.
     </p>
   </li><li class="listitem ">
     <p>Container builds can specify additional tags via <code class="command">OBS-AddTag:$TAG</code>. (kiwi limits it to one tag)
  	   in obs://$PROJECT/$REPOSITORY style.
     </p>
   </li></ul></div>
 </div>

 
 
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.source_service.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 6 </span>Using Source Services</span></a><a class="nav-link" href="cha.obs.basicworkflow.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 4 </span>Basic OBS Workflow</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2019 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>