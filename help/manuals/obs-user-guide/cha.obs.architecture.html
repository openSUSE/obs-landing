<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>OBS Architecture | User Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.2.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.81.0 (based on DocBook XSL Stylesheets snapshot) - chunked" /><meta name="book-title" content="User Guide" /><meta name="chapter-title" content="Chapter 18. OBS Architecture" /><meta name="description" content="TBD" /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="par.reference.html" title="Part VI. Reference" /><link rel="prev" href="par.reference.html" title="Part VI. Reference" /><link rel="next" href="cha.obs.concepts.html" title="Chapter 19. OBS Concepts" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.reference.html">Reference</a><span> › </span><a class="crumb" href="cha.obs.architecture.html">OBS Architecture</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>User Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk02pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="par.first_steps.html"><span class="number">I </span><span class="name">First Steps</span></a><ol><li class="inactive"><a href="art.obs.bg.html"><span class="number">1 </span><span class="name">Beginnerʼs Guide</span></a></li></ol></li><li class="inactive"><a href="par.concepts.html"><span class="number">II </span><span class="name">Concepts</span></a><ol><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">2 </span><span class="name">Supported Build Recipes and Package Formats</span></a></li></ol></li><li class="inactive"><a href="bk02pt03.html"><span class="number">III </span><span class="name">Setup</span></a><ol><li class="inactive"><a href="cha.obs.osc.html"><span class="number">3 </span><span class="name">osc, the Command Line Tool</span></a></li><li class="inactive"><a href="cha.obs.prjconfig.html"><span class="number">4 </span><span class="name">Project Configuration</span></a></li></ol></li><li class="inactive"><a href="par.working.html"><span class="number">IV </span><span class="name">Usage</span></a><ol><li class="inactive"><a href="cha.obs.basicworkflow.html"><span class="number">5 </span><span class="name">Basic OBS Workflow</span></a></li><li class="inactive"><a href="cha.obs.building.html"><span class="number">6 </span><span class="name">Local Building</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">7 </span><span class="name">Using Source Services</span></a></li><li class="inactive"><a href="cha.obs.stagingworkflow.html"><span class="number">8 </span><span class="name">Staging Workflow</span></a></li></ol></li><li class="inactive"><a href="par.best_practices.html"><span class="number">V </span><span class="name">Best Practices</span></a><ol><li class="inactive"><a href="cha.obs.best-practices.webuiusage.html"><span class="number">9 </span><span class="name">Using the OBS Web UI</span></a></li><li class="inactive"><a href="cha.obs.best-practices.basics.html"><span class="number">10 </span><span class="name">Basic Concepts and Work Styles</span></a></li><li class="inactive"><a href="cha.obs.best-practices.scm_integration.html"><span class="number">11 </span><span class="name">How to integrate external SCM sources</span></a></li><li class="inactive"><a href="cha.obs.best-practices.upstream.html"><span class="number">12 </span><span class="name">Publishing Upstream Binaries</span></a></li><li class="inactive"><a href="cha.obs.best-practices.bootstrapping.html"><span class="number">13 </span><span class="name">Bootstrapping</span></a></li><li class="inactive"><a href="cha.obs.best-practices.oscexamples.html"><span class="number">14 </span><span class="name"><code class="command">osc</code> Example Commands</span></a></li><li class="inactive"><a href="cha.obs.best-practices.advanced.html"><span class="number">15 </span><span class="name">Advanced Project Setups</span></a></li><li class="inactive"><a href="cha.obs.best-practices.kmp.html"><span class="number">16 </span><span class="name">Building Kernel Modules</span></a></li><li class="inactive"><a href="cha.obs.best-practices.howto.html"><span class="number">17 </span><span class="name">Common Questions and Solutions</span></a></li></ol></li><li class="inactive"><a href="par.reference.html"><span class="number">VI </span><span class="name">Reference</span></a><ol><li class="inactive"><a href="cha.obs.architecture.html"><span class="number">18 </span><span class="name">OBS Architecture</span></a></li><li class="inactive"><a href="cha.obs.concepts.html"><span class="number">19 </span><span class="name">OBS Concepts</span></a></li><li class="inactive"><a href="cha.obs.build_process.html"><span class="number">20 </span><span class="name">Build Process</span></a></li><li class="inactive"><a href="cha.obs.build_containers.html"><span class="number">21 </span><span class="name">Build Containers</span></a></li><li class="inactive"><a href="cha.obs.source_management.html"><span class="number">22 </span><span class="name">Source Management</span></a></li><li class="inactive"><a href="cha.obs.supported_formats.html"><span class="number">23 </span><span class="name">Supported Formats</span></a></li><li class="inactive"><a href="cha.obs.request_and_review_system.html"><span class="number">24 </span><span class="name">Request And Review System</span></a></li><li class="inactive"><a href="cha.obs.image_templates.html"><span class="number">25 </span><span class="name">Image Templates</span></a></li><li class="inactive"><a href="cha.obs.multibuild.html"><span class="number">26 </span><span class="name">Multiple Build Description File Handling</span></a></li><li class="inactive"><a href="cha.obs.maintenance_setup.html"><span class="number">27 </span><span class="name">Maintenance Support</span></a></li><li class="inactive"><a href="cha.obs.binary_tracking.html"><span class="number">28 </span><span class="name">Binary Package Tracking</span></a></li><li class="inactive"><a href="cha.obs.admin.html"><span class="number">29 </span><span class="name">Administration</span></a></li><li class="inactive"><a href="cha.obs.build_scheduling_and_dispatching.html"><span class="number">30 </span><span class="name">Scheduling and Dispatching</span></a></li><li class="inactive"><a href="cha.obs.build_job_constraints.html"><span class="number">31 </span><span class="name">Build Job Constraints</span></a></li><li class="inactive"><a href="cha.obs.build_preinstall.html"><span class="number">32 </span><span class="name">Building Preinstall Images</span></a></li><li class="inactive"><a href="cha.obs.authorization.token.html"><span class="number">33 </span><span class="name">Authorization</span></a></li><li class="inactive"><a href="cha.obs.qa_hooks.html"><span class="number">34 </span><span class="name">Quality Assurance(QA) Hooks</span></a></li><li class="inactive"><a href="cha.obs.factory.html"><span class="number">35 </span><span class="name">openSUSE Factory</span></a></li></ol></li><li class="inactive"><a href="obs.glossary.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="bk02apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Part VI. Reference" href="par.reference.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 19. OBS Concepts" href="cha.obs.concepts.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="User Guide"><span class="book-icon">User Guide</span></a><span> › </span><a class="crumb" href="par.reference.html">Reference</a><span> › </span><a class="crumb" href="cha.obs.architecture.html">OBS Architecture</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Part VI. Reference" href="par.reference.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 19. OBS Concepts" href="cha.obs.concepts.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.architecture"><div class="titlepage"><div><div><h2 class="title"><span class="number">18 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">OBS Architecture</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#">#</a></h2></div><div><div class="abstract">
   <p>
     
   </p>
  </div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.architecture.html#_overview_graph"><span class="number">18.1 </span><span class="name">Overview Graph</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.architecture.html#_communication_flow"><span class="number">18.2 </span><span class="name">Communication Flow</span></a></span></dt></dl></div></div>
 
 

 <div class="sect1 " id="_overview_graph"><div class="titlepage"><div><div><h2 class="title"><span class="number">18.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Overview Graph</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_overview_graph">#</a></h2></div></div></div>
  
  <p> Open Build Service (OBS) is not a monolithic server; it consists of multiple daemons
   that fulfill different tasks (see <a class="xref" href="cha.obs.architecture.html#fig.overview.simplified" title="Simplified OBS Component Overview">Figure 18.1, “Simplified OBS Component Overview”</a>). </p>
  <div class="figure" id="fig.overview.simplified"><div class="figure-contents">
   
   <div class="mediaobject"><a xmlns="" href="images/obs_components.png" target="_blank"><img src="images/obs_components.png" width="" alt="Simplified OBS Component Overview" /></a></div>
  </div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 18.1: </span><span class="name">Simplified OBS Component Overview </span><a title="Permalink" class="permalink" href="cha.obs.architecture.html#fig.overview.simplified">#</a></h6></div></div>
  <p>
  The OBS Back-end 
  manages the source files and build jobs of the OBS.
 </p>

 <div class="variablelist "><dl class="variablelist"><dt id="id-1.5.10.2.3.5.1"><span class="term ">Source Server</span></dt><dd>
     <p> Maintains the source repository and project/package configurations.
      It provides an HTTP interface, which is the only interface for the
      Front-end and It may forward requests to further back-end services.
     </p>
     <p> The Source Server keeps track of all sources that are available for
      building. It takes care of file deduplication so that every source file
      is stored only once. This is done by keeping track of the MD5 hashes of
      the files in combination with the file names. All revisions of committed
      sources are stored and will not be deleted. This guarantees the ability
      to get the source for every delivered binary package. </p>
     <p> Each OBS installation has one Source Server only. It maintains the
      "sources", "trees" and "projects" directories. </p>
   </dd><dt id="id-1.5.10.2.3.5.2"><span class="term ">Repository Server</span></dt><dd>
     <p>
      A repository server provides access to the binaries via an HTTP
      interface. It is used by the front-end via the source server only.
      Workers use the server for registration, requesting the needed binaries
      for the build jobs and storing the result. Notifications for schedulers
      are also created by repository servers. Each OBS installation has at
      least one repository server. A larger installation using partitioning has
      one on each partition.
     </p>
   </dd><dt id="id-1.5.10.2.3.5.3"><span class="term ">Scheduler</span></dt><dd>
    <p> A scheduler calculates the need for build jobs. It detects changes in
     sources, project configurations or in binaries used in the build
     environment. It is responsible for starting jobs in the right order and
     integrating the built binary packages. Each OBS installation has one
     scheduler per available architecture and partition. It maintains the
     content of the "build" directory. </p>
   </dd><dt id="id-1.5.10.2.3.5.4"><span class="term ">Dispatcher</span></dt><dd>
    <p> The dispatcher takes a job (created by the scheduler) and assigns it
     to a free worker. It also checks possible build constraints to verify that
     the worker qualifies for the job. It only notifies a worker about a job; the
     worker downloads the needed resources itself afterwards. Each OBS
     installation has one dispatcher per partition, one of which is the master
     dispatcher. </p>
    <p> The dispatcher tries to assign jobs fairly between the project
     repositories. For this the dispatcher maintains a <span class="strong"><strong>load</strong></span> per project repository (similar to the Unix system load)
     of used build time. The dispatcher assigned jobs to build clients from the
     repository with the lowest load (thereby increasing its load). It is
     possible to tweak this mechanism via dispatching priorities assigned to the
     repositories via the <span class="emphasis"><em>/build/<span class="emphasis"><em>_dispatchprios</em></span>
      <span class="strong"><strong>API</strong></span></em></span> call or via the <span class="strong"><strong>dispatch_adjust</strong></span> map in the BSConfig.pm
     configuration file. See the dispatch priorities in reference guide for more
     details. </p>
   </dd><dt id="id-1.5.10.2.3.5.5"><span class="term ">Publisher</span></dt><dd>
     <p> The publisher processes publish events from the scheduler for
      finished repositories. It merges the build result of all architectures
      into a defined directory structure, creates the needed metadata, and may
      sync it to a download server. It maintains the content of the "repos"
      directory on the back-end. Each OBS installation has one publisher per
      partition. </p>
   </dd><dt id="id-1.5.10.2.3.5.6"><span class="term ">Signer</span></dt><dd>
     <p>
      The signer handles signing events and calls an external tool to
      execute the signing. Each OBS installation usually has one signer per
      partition and also on the source server installation.
      </p>
   </dd><dt id="id-1.5.10.2.3.5.7"><span class="term ">Source Service Server</span></dt><dd>
    <p>
     The Source Service Server helps to automate processes for <span class="strong"><strong>continuous integration</strong></span>. The server can call
     different services for different tasks. It can download sources from
     websites and version control systems such as subversion and git. Services
     can also include working on the source to extract spec-files from archives,
     repacking the archives or adjusting version numbers in spec files. It is
     also often used to enforce policies by running checks. A failed check will
     appear as broken source and blocks a package from building. </p>
    <p> The Source Service Server is optional and currently only one Source
     Service Server is supported.
    </p>
   </dd><dt id="id-1.5.10.2.3.5.8"><span class="term ">Download on Demand Updater (dodup) (OBS version 2.7 or later)</span></dt><dd>
     <p>
      The download on demand updater monitors all external repositories
      which are defined as download on demand resources. It polls for changes
      in the metadata and re-downloads the metadata in case. The scheduler will
      be notified to recalculate the build jobs depending on these repositories
      afterwards. Each OBS installation can have one dodup service running on
      each partition. </p>
   </dd><dt id="id-1.5.10.2.3.5.9"><span class="term ">Delta Store (OBS version 2.7 or later)</span></dt><dd>
     <p>
      The delta store daemon maintains the deltas in the source storage.
      Multiple obscpio archives can be stored in one deltastore to avoid
      duplication on disk. This service calculates the delta and maintains the
      delta store. Each OBS installation can have one delta store process
      running next to the source server.
     </p>
   </dd><dt id="id-1.5.10.2.3.5.10"><span class="term ">Worker</span></dt><dd>
     <p>
      The workers register with the repository servers. They receive build
      jobs from the dispatcher. Afterwards they download sources from the
      source server and the needed binaries from the repository server(s). They
      build the package using the build script and send the result back to the
      repository server. A worker can run on the same host as the other
      services, but most OBS installations have dedicated hardware for the
      workers.
     </p>
   </dd></dl></div>
 </div>



 <div class="sect1 " id="_communication_flow"><div class="titlepage"><div><div><h2 class="title"><span class="number">18.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Communication Flow</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_communication_flow">#</a></h2></div></div></div>
  
  <p>
   The communication flow can be split into the following major parts:
  </p>
  <div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem ">
    <p>
     communication between users and front-end
    </p>
   </li><li class="listitem ">
    <p>
     communication between front-end and source server
    </p>
   </li><li class="listitem ">
    <p>
     communication between source server and other back-end
     components, in particular the repository servers.
    </p>
   </li><li class="listitem ">
    <p>
     communication between the back-end and the stage server to publish
     build results
    </p>
   </li></ol></div>
  <p>
   The user uses the front-end (via tools like <code class="command">osc</code>) to
   communicate with the Open Build Service.
   The front-end is providing a web interface and also an API.
   The front-end is implemented as a Ruby on Rails application.
   All communication happens via the HTTP protocol (usually encrypted, meaning
   HTTPS is used).
  </p>
  <p>
   The communication between the front-end and the back-end also uses
   the HTTP protocol, using the back-end source server as the gateway to most
   other back-end components.
  </p>

  <div class="figure" id="fig_obs_communication"><div class="figure-contents">
   
   <div class="mediaobject"><a xmlns="" href="images/obs_communication.png" target="_blank"><img src="images/obs_communication.png" width="" alt="OBS Communication (Simplified)" /></a></div>
  </div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 18.2: </span><span class="name">OBS Communication (Simplified) </span><a title="Permalink" class="permalink" href="cha.obs.architecture.html#fig_obs_communication">#</a></h6></div></div>
  <p>
   The figure <a class="xref" href="cha.obs.architecture.html#fig_obs_communication" title="OBS Communication (Simplified)">Figure 18.2, “OBS Communication (Simplified)”</a> shows the
   communication flow between the OBS components if a package source
   (for example, a <code class="filename">_service</code> file) was updated:
  </p>
  <div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem ">
    <p>
     The new source file is uploaded with an HTTP PUT operation to the
     <span class="strong"><strong>front-end</strong></span>.
     The front-end authenticates and checks the permissions of the user.
    </p>
   </li><li class="listitem ">
    <p>
     If the user has appropriate permissions, the new file will be sent to
     the back-end <span class="strong"><strong>source server</strong></span> via an
     HTTP PUT request.
     The source server stores the changed source under revision control.
    </p>
    <p>
     It then checks whether this change makes source service runs necessary.
     If so, the <span class="strong"><strong>source service server</strong></span> is
     informed via an HTTP PUT request of the <code class="filename">_service</code>
     file to run the requested services.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>source service server</strong></span> runs all
     required source services.
     For example, it could download the requested revision from a Git server.
     After running all services, it delivers the final sources back to the
     <span class="strong"><strong>source server</strong></span>, which then stores these
     under revision control.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>source server</strong></span> then notifies the
     <span class="strong"><strong>schedulers</strong></span> for each hardware
     architecture required about the change of the package via an event.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>scheduler</strong></span> then recalculates package
     and project state.
     If all build requirements are fulfilled, a build job is created and added
     to the <span class="strong"><strong>job pool</strong></span>.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>dispatcher</strong></span> is notified and selects
     a free <span class="strong"><strong>worker</strong></span> which meets the build
     constraints for the job and sends the job to it.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>worker</strong></span> downloads the sources from
     the <span class="strong"><strong>source server</strong></span> and all required
     binary packages from the <span class="strong"><strong>repository
     server</strong></span>.
     The package then will be built.
    </p>
    <p>
     The <span class="strong"><strong>worker</strong></span> is monitored by the
     <span class="strong"><strong>warden</strong></span> service to detect any
     <span class="strong"><strong>worker</strong></span> crashes.
    </p>
   </li><li class="listitem ">
    <p>
     If the build succeeds, the build results (including build logs) are
     uploaded to the <span class="strong"><strong>scheduler</strong></span>.
     If requested, the <span class="strong"><strong>signer</strong></span> signs the
     packages.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>scheduler</strong></span> recalculates the project
     status, checking whether dependent packages need to be rebuilt.
     If not, it requests the <span class="strong"><strong>publisher</strong></span> to
     publish the build results.
    </p>
   </li><li class="listitem ">
    <p>
     The <span class="strong"><strong>publisher</strong></span> will create an updated
     version of the output repository and request the
     <span class="strong"><strong>signer</strong></span> to sign the repository metadata.
    </p>
   </li></ol></div>
 </div>
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.concepts.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 19 </span>OBS Concepts</span></a><a class="nav-link" href="par.reference.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Part VI </span>Reference</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>