<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>How to integrate external SCM sources | Best Practice Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.13 (based on DocBook XSL Stylesheets snapshot) - chunked" /><meta name="book-title" content="Best Practice Guide" /><meta name="chapter-title" content="Chapter 3. How to integrate external SCM sources" /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="book.obs-best-practices.html" title="Best Practice Guide" /><link rel="prev" href="cha.obs.best-practices.basics.html" title="Chapter 2. Basic Concepts and Work Styles" /><link rel="next" href="cha.obs.best-practices.upstream.html" title="Chapter 4. Publishing Upstream Binaries" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Best Practice Guide"><span class="book-icon">Best Practice Guide</span></a><span> › </span><a class="crumb" href="cha.obs.best-practices.scm_integration.html">How to integrate external SCM sources</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Best Practice Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk05pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="cha.obs.best-practices.webuiusage.html"><span class="number">1 </span><span class="name">Using the OBS Web UI</span></a></li><li class="inactive"><a href="cha.obs.best-practices.basics.html"><span class="number">2 </span><span class="name">Basic Concepts and Work Styles</span></a></li><li class="inactive"><a href="cha.obs.best-practices.scm_integration.html"><span class="number">3 </span><span class="name">How to integrate external SCM sources</span></a></li><li class="inactive"><a href="cha.obs.best-practices.upstream.html"><span class="number">4 </span><span class="name">Publishing Upstream Binaries</span></a></li><li class="inactive"><a href="cha.obs.best-practices.localsetup.html"><span class="number">5 </span><span class="name">Setting Up a Local OBS Instance</span></a></li><li class="inactive"><a href="cha.obs.best-practices.bootstrapping.html"><span class="number">6 </span><span class="name">Bootstrapping</span></a></li><li class="inactive"><a href="cha.obs.best-practices.oscexamples.html"><span class="number">7 </span><span class="name"><code class="command">osc</code> Example Commands</span></a></li><li class="inactive"><a href="cha.obs.best-practices.advanced.html"><span class="number">8 </span><span class="name">Advanced Project Setups</span></a></li><li class="inactive"><a href="cha.obs.best-practices.kmp.html"><span class="number">9 </span><span class="name">Building Kernel Modules</span></a></li><li class="inactive"><a href="cha.obs.best-practices.howto.html"><span class="number">10 </span><span class="name">Common Questions and Solutions</span></a></li><li class="inactive"><a href="bk05apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 2. Basic Concepts and Work Styles" href="cha.obs.best-practices.basics.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 4. Publishing Upstream Binaries" href="cha.obs.best-practices.upstream.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Best Practice Guide"><span class="book-icon">Best Practice Guide</span></a><span> › </span><a class="crumb" href="cha.obs.best-practices.scm_integration.html">How to integrate external SCM sources</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 2. Basic Concepts and Work Styles" href="cha.obs.best-practices.basics.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 4. Publishing Upstream Binaries" href="cha.obs.best-practices.upstream.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.best-practices.scm_integration"><div class="titlepage"><div><div><h1 class="title"><span class="number">3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">How to integrate external SCM sources</span> </h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.best-practices.scm_integration.html#id-1.8.7.4"><span class="number">3.1 </span><span class="name">How to create a source service</span></a></span></dt></dl></div></div>
 
 
   <p>
     Application development usualy happens in SCM systems like git, subversion, mercurial
     and alike. These external sources can be used directly in OBS via source services.
     OBS will always keep a copy of the sources to guarantee that the build sources
     are still available even when the external SCM server disappears or get altered.
   </p>
   <div class="sect1 " id="id-1.8.7.4"><div class="titlepage"><div><div><h2 class="title" id="id-1.8.7.4"><span class="number">3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">How to create a source service</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.scm_integration.html#id-1.8.7.4">#</a></h2></div></div></div>
     
     <p>
      Let OBS create a tar ball out of an SCM repository. This just creates or
      extend a _service file with some rules how to download and package sources.
      The actual work happens on a local build or on a service side build. Please
      note that you need the obs-service-obs_scm installed for local runs.
     </p>
     <div class="verbatim-wrap"><pre class="screen">       <code class="command">
# osc add https://SOME_URL.git
       </code></pre></div>
     <p>
      The web interface is creating as well a _service file when adding an URL
      to a SCM system.
     </p>
     <div class="sect2 " id="id-1.8.7.4.5"><div class="titlepage"><div><div><h3 class="title" id="id-1.8.7.4.5"><span class="number">3.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Follow upstream branches</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.scm_integration.html#id-1.8.7.4.5">#</a></h3></div></div></div>
       
       <p>
       The created _service file is set up to follow latest source submissions on each
       run and looks like this:
       </p>
        <div class="verbatim-wrap"><pre class="screen">          <code class="command">
&lt;services&gt;
  &lt;service name="obs_scm"&gt;
    &lt;param name="url"&gt;https://github.com/FreeCAD/FreeCAD.git&lt;/param&gt;
    &lt;param name="scm"&gt;git&lt;/param&gt;
  &lt;/service&gt;

  &lt;service name="set_version" mode="buildtime"/&gt;
  &lt;service name="tar" mode="buildtime"/&gt;
  &lt;service name="recompress" mode="buildtime"&gt;
    &lt;param name="file"&gt;*.tar&lt;/param&gt;
    &lt;param name="compression"&gt;xz&lt;/param&gt;
  &lt;/service&gt;
&lt;/services&gt;
          </code></pre></div>
       <p>
        This will create an obscpio archive via the obs_scm service with the latest sources. 
        This archive will get extracted at build time and be processed via the other services
        to build a compressed tar ball for rpmbuild. 
        To follow a specific branch and additional parameter for "revision" is needed for the
        obs_scm service.
       </p>
     </div>
     <div class="sect2 " id="id-1.8.7.4.6"><div class="titlepage"><div><div><h3 class="title" id="id-1.8.7.4.6"><span class="number">3.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Fixed versions</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.scm_integration.html#id-1.8.7.4.6">#</a></h3></div></div></div>
       
       <p>
         You may want to build an archive for a fixed version, for example an official release
         which has been tagged by the upstream project. It is recommend to specify the 
         mode="disabled" and to submit the archive via the following
       </p>
        <div class="verbatim-wrap"><pre class="screen">          <code class="command">
# osc service runall
# osc ar
# osc commit
          </code></pre></div>
       <p>
        commands.
       </p>
     </div>
     <div class="sect2 " id="id-1.8.7.4.7"><div class="titlepage"><div><div><h3 class="title" id="id-1.8.7.4.7"><span class="number">3.1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Avoid tar balls</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.scm_integration.html#id-1.8.7.4.7">#</a></h3></div></div></div>
       
       <p>
         tar balls are not a requirement by OBS, but by the packaging tool, eg. rpmbuild. However,
         you may want to decide not to ship a tar ball inside of the src.rpm. This makes sense for
         large sources where the compression time and needed disk space is just considered a waste
         for short living builds. You can simplify your _service file in that case, but you need to help rpmbuild to work directly in the source.
         It is also a good practice to package the _service file instead of the tar ball to 
         give the user a chance to rebuild the src.rpm as long the external SCM server is
         providing the sources. The simplified _service file looks like this:
       </p>
        <div class="verbatim-wrap"><pre class="screen">          <code class="command">
&lt;services&gt;
  &lt;service name="obs_scm"&gt;
    &lt;param name="url"&gt;https://github.com/FreeCAD/FreeCAD.git&lt;/param&gt;
    &lt;param name="scm"&gt;git&lt;/param&gt;
  &lt;/service&gt;

  &lt;service name="set_version" mode="buildtime"/&gt;
&lt;/services&gt;
          </code></pre></div>
       <p>
        The spec file needs some hints to build inside the extracted sources directly. The macro
        can be used to switch to build tar balls or not to keep it working for stable releases where
        you want to provide a complete source rpm.
       </p>
        <div class="verbatim-wrap"><pre class="screen">          <code class="command">
...
%define build_tar_ball 0
...
%if %{build_tar_ball}
Source0:        %{name}-%version.tar.xz
%else
Source0:        _service
%endif
...
%prep
%if %{build_tar_ball}
 %setup -q
%else
 %setup -q -n %_sourcedir/%name-%version -T -D
%endif
          </code></pre></div>
     </div>
   </div>
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.best-practices.upstream.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 4 </span>Publishing Upstream Binaries</span></a><a class="nav-link" href="cha.obs.best-practices.basics.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 2 </span>Basic Concepts and Work Styles</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2019 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>