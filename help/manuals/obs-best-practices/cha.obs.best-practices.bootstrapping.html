<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Bootstrapping | Best Practice Guide</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.13 (based on DocBook XSL Stylesheets snapshot) - chunked" /><meta name="book-title" content="Best Practice Guide" /><meta name="chapter-title" content="Chapter 6. Bootstrapping" /><link rel="home" href="index.html" title="OBS Documentation" /><link rel="up" href="book.obs-best-practices.html" title="Best Practice Guide" /><link rel="prev" href="cha.obs.best-practices.localsetup.html" title="Chapter 5. Setting Up a Local OBS Instance" /><link rel="next" href="cha.obs.best-practices.oscexamples.html" title="Chapter 7. osc Example Commands" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Best Practice Guide"><span class="book-icon">Best Practice Guide</span></a><span> › </span><a class="crumb" href="cha.obs.best-practices.bootstrapping.html">Bootstrapping</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.htmlindex.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Best Practice Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="bk05pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="cha.obs.best-practices.webuiusage.html"><span class="number">1 </span><span class="name">Using the OBS Web UI</span></a></li><li class="inactive"><a href="cha.obs.best-practices.basics.html"><span class="number">2 </span><span class="name">Basic Concepts and Work Styles</span></a></li><li class="inactive"><a href="cha.obs.best-practices.scm_integration.html"><span class="number">3 </span><span class="name">How to integrate external SCM sources</span></a></li><li class="inactive"><a href="cha.obs.best-practices.upstream.html"><span class="number">4 </span><span class="name">Publishing Upstream Binaries</span></a></li><li class="inactive"><a href="cha.obs.best-practices.localsetup.html"><span class="number">5 </span><span class="name">Setting Up a Local OBS Instance</span></a></li><li class="inactive"><a href="cha.obs.best-practices.bootstrapping.html"><span class="number">6 </span><span class="name">Bootstrapping</span></a></li><li class="inactive"><a href="cha.obs.best-practices.oscexamples.html"><span class="number">7 </span><span class="name"><code class="command">osc</code> Example Commands</span></a></li><li class="inactive"><a href="cha.obs.best-practices.advanced.html"><span class="number">8 </span><span class="name">Advanced Project Setups</span></a></li><li class="inactive"><a href="cha.obs.best-practices.kmp.html"><span class="number">9 </span><span class="name">Building Kernel Modules</span></a></li><li class="inactive"><a href="cha.obs.best-practices.howto.html"><span class="number">10 </span><span class="name">Common Questions and Solutions</span></a></li><li class="inactive"><a href="bk05apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 5. Setting Up a Local OBS Instance" href="cha.obs.best-practices.localsetup.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 7. osc Example Commands" href="cha.obs.best-practices.oscexamples.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Best Practice Guide"><span class="book-icon">Best Practice Guide</span></a><span> › </span><a class="crumb" href="cha.obs.best-practices.bootstrapping.html">Bootstrapping</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 5. Setting Up a Local OBS Instance" href="cha.obs.best-practices.localsetup.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 7. osc Example Commands" href="cha.obs.best-practices.oscexamples.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.best-practices.bootstrapping"><div class="titlepage"><div><div><h1 class="title"><span class="number">6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Bootstrapping</span> </h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.4"><span class="number">6.1 </span><span class="name">The Issue</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5"><span class="number">6.2 </span><span class="name">A Cheat Sheet</span></a></span></dt><dt><span class="sect1"><a href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.6"><span class="number">6.3 </span><span class="name">Creating a First Project</span></a></span></dt></dl></div></div>
 
 
 <p> This chapter explains Boot strapping. In this chapter, You would learn
  how you could have other OBS projects and packages to your local OBS instance
  after your OBS install. There are some useful OSC commands examples and OBS
  working mechanism explanation in this chapter also. Basically this chapter is
  a copy from Build Service portal. For information about OBS bootstrapping on
  the Build Service portal, see <a class="ulink" href="https://en.opensuse.org/openSUSE:Build_Service_private_instance_boot_strapping" target="_blank">https://en.opensuse.org/openSUSE:Build_Service_private_instance_boot_strapping</a>. </p>
 <div class="sect1 " id="id-1.8.10.4"><div class="titlepage"><div><div><h2 class="title" id="id-1.8.10.4"><span class="number">6.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">The Issue</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.4">#</a></h2></div></div></div>
  
  <p>
   If you create a private instance of an OBS it is likely to be fully
   independent. This means that your OBS needs to build its full reference
   tool chain. This process—called bootstrapping—presents the same problem as
   the Chicken and the Egg, which one came first! In other words, you need to
   create a tool chain with the tool chain that you want to create.
  </p>
 </div>
 <div class="sect1 " id="id-1.8.10.5"><div class="titlepage"><div><div><h2 class="title" id="id-1.8.10.5"><span class="number">6.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">A Cheat Sheet</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5">#</a></h2></div></div></div>
  
  <div class="sect2 " id="id-1.8.10.5.2"><div class="titlepage"><div><div><h3 class="title" id="id-1.8.10.5.2"><span class="number">6.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating Your First Project</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.2">#</a></h3></div></div></div>
   
   <p> Log on to the Web API. The default user Admin, with the password
     <code class="literal">opensuse</code> is available. Create your own login and
    password and set yourself as Admin. Log on to the Web UI as Admin and click
    on the icon <span class="guimenu ">Configuration</span> and add the openSUSE Build Service as the remote
    instance. Select from under <span class="guimenu ">Locations</span> › <span class="guimenu ">Projects</span>. At the end of the list, click <span class="guimenu ">Add
    Project</span>. Give it a name (e.g. Meego-test) Select your new project
    and create a sub-project 0.1. You have now a project Meego-test:1.0 Sub
    projects are handy to propagate Access Control Lists (acl) and for creating
    the version as a sub project simplifies the user and project
    administration. </p>
  </div>
  <div class="sect2 " id="id-1.8.10.5.3"><div class="titlepage"><div><div><h3 class="title" id="id-1.8.10.5.3"><span class="number">6.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Importing Your Base Linux Project</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.3">#</a></h3></div></div></div>
   
   <p> We are now going to import the base project. I will describe two
    methods, one where you have a login on a remote OBS instance, one where you
    have only access to the rpm repository. In both cases you will need access
    to binary and source rpm. </p>
   <div class="sect3 " id="id-1.8.10.5.3.3"><div class="titlepage"><div><div><h4 class="title" id="id-1.8.10.5.3.3"><span class="number">6.2.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">With a login on a remote OBS</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.3.3">#</a></h4></div></div></div>
    
    <p> The osc copypac (I assume that you have installed the osc package on
     your workstation) has an option -t which enables copying towards a remote
     target OBS instance. osc help and osc help command will advise on how to
     use these. First you need to import the project configuration. </p>
    <div class="verbatim-wrap"><pre class="screen">$ export PROJECT=MeeGo-test:0.1
$ osc -A http://api-url-source-obs meta prjconf $PROJECT &gt; my_project.conf
$ osc -A http://api-url-target-obs meta prjconf -F my_project.conf $PROJECT</pre></div>
    <p> Then import the project. As you might have some Links in the project
     that you import, it is a good idea to keep the source and target project
     names identical. </p>
    <div class="verbatim-wrap"><pre class="screen">$ PRJ=ProjectToCopy; for i in `osc -A http://api.source.obs.domain ls $PRJ`; do \\
osc -A http://api.source.obs.domain \\
copypac -t http://api.target.obs.domain $PRJ $i $PRJ ;done</pre></div>
   </div>
   <div class="sect3 " id="id-1.8.10.5.3.4"><div class="titlepage"><div><div><h4 class="title" id="id-1.8.10.5.3.4"><span class="number">6.2.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Without a Login on a Remote OBS</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.3.4">#</a></h4></div></div></div>
    
    <p> If you have access only to the repositories of your source reference
     target, then your life will be a bit more difficult. My advice would be to
     recheck if you find you cannot get a login on a public OBS service - such
     as provided by openSUSE or MeeGo - before proceeding this way. You will
     not be able to import the project config and you will have to create it by
     hand. This is too long to be covered in this HowTo. For more explanation
     about Build Service project config, see <a class="ulink" href="http://en.opensuse.org/openSUSE:Build_Service_prjconf" target="_blank">http://en.opensuse.org/openSUSE:Build_Service_prjconf</a>. </p>
    <p> Then you need to download all your rpm source on to a local machine
     and import it into your project with the command. </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command">$ osc importsrcpkg</code></pre></div>
   </div>
   <div class="sect3 " id="id-1.8.10.5.3.5"><div class="titlepage"><div><div><h4 class="title" id="id-1.8.10.5.3.5"><span class="number">6.2.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Bootstrapping</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.3.5">#</a></h4></div></div></div>
    
    <p> To initiate the build process, we will copy the rpm binary from the
     source OBS of the source project. These binary rpms, from which we will
     remove any reference to release and version, will be used to trigger the
     first build. The OBS appliance will recompile all the rpms until all rpms
     in the project have been compiled only with packages compiled from their
     source code. Some base packages (e.g. tool chains) will be compiled
     several times during that process. Alternative You can build a first time
     against a target which is similar to the base that you need to boot strap
     in lieu of building against your own base and change the build reference
     to your bootstrap base once that the first build has been successful.
     Remember that you can also build against remote baseline. Double check
     that the preliminary step have been executed correctly. You must have
     already : copied a Linux base distribution in an OBS project defined a
     build target for that base project. </p>
    <p> If you have not defined a build target, the necessary directory
     structure will not exist. This is a mandatory step of preparation. Stop
     the scheduler as it will create a mess if the system is not stable: </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command"># rcobsscheduler stop</code></pre></div>
    <p> * Add binaries to the :full directory of the Project ssh onto the
     OBS server. Now go to the project’s build directory, and create a
     directory called “:full”. Note : standard is the default name of your
     Build repository as defined in your project. It might change depending on
     who created the initial build repo. </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command"># cd /obs/build/$PROJECT/standard/i586</code></pre></div>
    <p> This directory structure should already exist. If not, there is a
     problem (note that /obs is link and the target may vary with your
     implementation). Now create the “:full” directory. $ mkdir :full Copy over
     all the binary rpms of the project you are trying to build from scratch.
     These rpms should have the release and version numbers stripped from them.
     e.g. alsa-utils-1.0.22-2.7.i586.rpm -- should be – alsa-utils.rpm Note :
     If the original project has a :full directory you can copy from there to
     avoid the issue of stripping version and release numbers. * Add binaries
     to the :full directory of the Project. Change all user/group privileges
     under /srv/obs/build/ to “obsrun” </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command"># chown -R obsrun:obsrun /srv/obs/build</code></pre></div>
    <p> If you leave root as owner of :full, it will still build but the
     scheduler will fail (almost silently) to upgrade :full with the latest
     built packages. Except in very special cases, it is very unlikely that you
     want to do so. * Start the OBS scheduler </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command"># rcobsscheduler start</code></pre></div>
    <p> * Force the obs to reindex your new :full directory. It will send an
     event to the scheduler which will create a file named :full.solv </p>
    <div class="verbatim-wrap"><pre class="screen"><code class="command"># obs_admin --rescan-repository $OBS-PROJECT $REPO $ARCH</code></pre></div>
    <div class="sect4 " id="id-1.8.10.5.3.5.13"><div class="titlepage"><div><div><h5 class="title" id="id-1.8.10.5.3.5.13"><span class="number">6.2.2.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Troubleshooting</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.5.3.5.13">#</a></h5></div></div></div>
     
     <p> At that time you should see your project restarting to build. If
      that would not be the case. * check that your files in your target :full
      directory are all own by the user obsrun. The following command should
      not return any file name. </p>
     <div class="verbatim-wrap"><pre class="screen">#find /obs/build ! -user obsrun
#chown -R obsrun:obsrun  /obs/build   (will correct ownership issue)</pre></div>
     <p> * Force the obs to reindex your new :full directory. It will create
      a file named :full.solv </p>
     <div class="verbatim-wrap"><pre class="screen"><code class="command">$obs_admin --rescan-repository $OBS-PROJECT $REPO $ARCH</code></pre></div>
     <p> * Check that your rpm are valid (e.g. not damaged during transfer) </p>
     <div class="verbatim-wrap"><pre class="screen">#cd /obs/build/$PROJECT/standard/i586:full
#for I in `ls *.rpm` ; do rpm -qlp $I &gt;/dev/null; if [ $? -ne 0 ] ;then echo $I &gt;&gt;../error.lst ; fi ; done
#cat ../error.lst (must be empty, all rpm in error needs re-installation)</pre></div>
     <p> * Still not working, get a look in the log files in the directory
      /obs/log. You can start by having a look at
      /obs/log/scheduler_TARGET_ARCH.log and search from the end for the string
      "expanding dependencies". You will find from there why the scheduler
      fails. </p>
     <div class="verbatim-wrap"><pre class="screen"><code class="command">#tail -f /obs/log/scheduler_i586.log</code></pre></div>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1 " id="id-1.8.10.6"><div class="titlepage"><div><div><h2 class="title" id="id-1.8.10.6"><span class="number">6.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating a First Project</span> <a title="Permalink" class="permalink" href="cha.obs.best-practices.bootstrapping.html#id-1.8.10.6">#</a></h2></div></div></div>
  
  <p> After creating a dedicated user via the Web API, log onto the Web UI
   again with your new login. Open your home project and create a sub project
   called "MyTest". To add a package in your new Home project, simply create a
   link [link Package from other Project] with one of the packages recently
   copied in your new OBS instance (see previous chapter Import your base
   project). Pick up a small one to speed compilation time. Click on the "+"
   near Build Repositories to add a repository. Move to the end of the page
   where all the standard Linux distributions are listed and click on
   [Advance]. Give a name to your repo, e.g. my-test and pick from the list the
   project/repo that you have just imported and rebuilt. This will request the
   OBS to build your new Home project against that repository. You can now
   check out your Home project with the osc command, modify a file or two and
   at your next check-in, the OBS will rebuild your Home project. If your
   reference project changes, the OBS will also rebuild your Home project.
  </p>
 </div>
</div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.best-practices.oscexamples.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 7 </span><code class="command">osc</code> Example Commands</span></a><a class="nav-link" href="cha.obs.best-practices.localsetup.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 5 </span>Setting Up a Local OBS Instance</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2019 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>